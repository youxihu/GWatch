# GWatch 监控工具配置文件 - 精简优化版

# 主机类监控配置
host_monitoring:
  enabled: true
  interval: 5s
  consecutive_threshold: 3
  alert_interval: 5m
  alert_title: "香港视频化主服务器告警"
  cpu_threshold: 80.0
  memory_threshold: 70.0
  disk_threshold: 80.0

# 应用层类监控配置
app_monitoring:
  enabled: false

  redis:
    enabled: true
    addr: "192.168.1.218:6379"
    password: "ningzaichun"
    db: 0
    timeout: 5s
    pool_size: 5
    min_idle_conns: 1
    max_idle_conns: 3
    min_clients: 0
    max_clients: 20

  mysql:
    enabled: false
    host: "192.168.1.218"
    port: 21806
    username: "youxihu"
    password: "youxihu"
    database: "information_schema"
    timeout: 10s
    interval: 60s
    # 核心监控阈值（精简版）
    thresholds:
      max_connections_usage_warning: 85.0   # 连接数使用率（%）
      threads_running_warning: 50           # 活跃线程数
      slow_queries_rate_warning: 10         # 每分钟慢查询增量告警阈值
      buffer_pool_hit_rate_warning: 95.0    # Buffer Pool 命中率低于此值告警（%）
      replication_delay_warning_seconds: 300 # 仅当 replication.enabled=true 时生效
      deadlocks_per_hour_warning: 5         # 每小时死锁次数

    replication:
      enabled: false
      delay_warning_seconds: 300

  http:
    enabled: true
    error_threshold: 0
    interval: 10s
    interfaces:
      - name: "example-public-captcha"
        url: "https://example.example.com/prod-api/captchaImage"
        need_alert: true
        timeout: 10s
        allowed_codes: [200, 201, 204]
      - name: "example-example-captcha"
        url: "http://172.25.216.169:7080/captchaImage"
        need_alert: false
        timeout: 10s
        allowed_codes: [200, 201, 204]

  tickers:
    enabled: false
    alert_title: "视频设备状态定时报告"
    ticker_interfaces:
      - name: "number of monitoring devices"
        device_url: "https://example.example.com/prod-api/api/device/query/getDDCTree"
        alert_time: ["8:00", "10:00", "13:00", "16:00"]
        auth:
          mode: "static"
          static_token: "Bearer eyJhbGciOiJIUzUxMiJ9.eyJsb2dpbl91c2VyX2tleSI6IjQ3MWVmYmQwLWY4NmUtNGQ3Yi04MTZhLTljY2E5ZDg5Zjk4YyJ9.-OtqDUDW5kE7dXRp4v6Pc5W87EhwRrApCL0tDL6AQCXrfUteWqXg-gf5qx17bdKO34f2KI17sJ16viatzxkEMA"

# 全局定时推送配置
scheduled_push:
  enabled: true
  mode: "server"  # client: 上传数据到Redis, server: 从Redis聚合并发送
  rds_url: "192.168.1.218:6379"  # Redis地址（用于client/server数据交换）
  rds_password: "ningzaichun"
  rds_db: 2  # 使用独立的Redis DB，避免与监控Redis冲突
  push_times: ["8:00", "9:00", "10:00", "10:55", "11:16", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00"]
  title: "169完整监控指标"
  include_host_monitoring: true
  include_app_monitoring: true
  alert_storage:
    enabled: true
    alert_log_path_template: "logs/%y/%m-%d/scheduled_push-%H%M.log"
    format: "json"
    retention_days: 30

# 通用配置
dingtalk:
  webhook_url: "https://oapi.dingtalk.com/robot/send?access_token=bfd9580e7d49a959e986c7438bfa014ddb694b7b1a695fab1b46c7010b06ebad"
  secret: "SEC0b0f0a3d4f43d1d21d0a66d0d4dbd6b5c16450266d49aadbae66d12fe97b22fa"
  at_mobiles: ["19******502"]

log:
  mode: both
  level: info
  output: logs/gwatch.log
  enable_rotation: true
  max_size: 100
  max_age: 30
  max_backups: 10

whiteProcessList:
  - "cursor"
  - "goland"
  - "bash"

# 独立工具脚本配置（非监控项，仅路径引用）
javaAppDumpScript:
  path: /home/youxihu/hk_video/createJavaMapDump.sh
